ungroup %>%
select(SurveySeason,taxa)
names(which_surveys) <- c("SurveySeason","taxa")
print(which_surveys)
which_surveys%>%
group_by(SurveySeason)
dplyr::summarize(n=n(),
detections = sum(taxa))%>%
filter(n>99&detections!=0)#%>%
ungroup()%>%
select(SurveySeason)%>%with(.,as.vector(SurveySeason))
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[1]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[1])%>%
left_join(region_lookup,by="Review_Stratum")
for(i in 2:length(which_surveys)){
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[i]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat_a <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[i])%>%
left_join(region_lookup,by="Review_Stratum")
plot_dat <- plot_dat %>% bind_rows(plot_dat_a)
}
plot_dat <- plot_dat %>% mutate(Review_Stratum = factor(Review_Stratum,levels=c("San Pablo Bay and Carquinez Strait",
"Napa River",
"Suisun and Honker Bays",
"Suisun Marsh",
"Confluence",
"South",
"North and South Forks Mokelumne River",
"Cache Slough",
"Sacramento Mainstem",
"Sacramento Ship Channel")))%>%
rename("Review Stratum" = "Review_Stratum")%>%
rename("Review Region" = "Review_Region")%>%
mutate(Upper = if_else(Upper==1 & Estimate==0,0,Upper))
print(plot_dat %>% ggplot(aes(y=`Review Stratum`,x=Estimate,col=`Review Region`))+theme_bw()+
scale_color_manual(values=wes_palette(n=5, name="Zissou1"))+
geom_vline(xintercept = 0)+xlab("Probability of Catch")+
geom_linerange(aes(xmin=Lower,xmax=Upper),size=1.5)+ggtitle(paste(print_name,"catch probabilities by region and strata"))+
geom_point(size=2.5)+
facet_grid(cols=vars(Survey)))
return(plot_dat)
}
Plot_Comparisons(taxa="CPUV_Delta_Smelt_Age_0",print_name = "Age-0 delta smelt")
Plot_Comparisons <- function(taxa = "CPUV_American_Shad_Age_0", scale = "Review_Stratum",print_name="Age-0 Delta Smelt"){
region_lookup <- Binary_Data %>%
select(Review_Region,Review_Stratum)%>%
distinct()
which_surveys <- Binary_Data %>%
ungroup %>%
select(SurveySeason,taxa)
names(which_surveys) <- c("SurveySeason","taxa")
print(which_surveys)
which_surveys%>%
group_by(SurveySeason)
dplyr::summarize(n=n(),
detections = sum(taxa))%>%
filter(n>99&detections!=0)%>%
ungroup()%>%
select(SurveySeason)%>%with(.,as.vector(SurveySeason))
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[1]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[1])%>%
left_join(region_lookup,by="Review_Stratum")
for(i in 2:length(which_surveys)){
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[i]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat_a <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[i])%>%
left_join(region_lookup,by="Review_Stratum")
plot_dat <- plot_dat %>% bind_rows(plot_dat_a)
}
plot_dat <- plot_dat %>% mutate(Review_Stratum = factor(Review_Stratum,levels=c("San Pablo Bay and Carquinez Strait",
"Napa River",
"Suisun and Honker Bays",
"Suisun Marsh",
"Confluence",
"South",
"North and South Forks Mokelumne River",
"Cache Slough",
"Sacramento Mainstem",
"Sacramento Ship Channel")))%>%
rename("Review Stratum" = "Review_Stratum")%>%
rename("Review Region" = "Review_Region")%>%
mutate(Upper = if_else(Upper==1 & Estimate==0,0,Upper))
print(plot_dat %>% ggplot(aes(y=`Review Stratum`,x=Estimate,col=`Review Region`))+theme_bw()+
scale_color_manual(values=wes_palette(n=5, name="Zissou1"))+
geom_vline(xintercept = 0)+xlab("Probability of Catch")+
geom_linerange(aes(xmin=Lower,xmax=Upper),size=1.5)+ggtitle(paste(print_name,"catch probabilities by region and strata"))+
geom_point(size=2.5)+
facet_grid(cols=vars(Survey)))
return(plot_dat)
}
Plot_Comparisons(taxa="CPUV_Delta_Smelt_Age_0",print_name = "Age-0 delta smelt")
Plot_Comparisons <- function(taxa = "CPUV_American_Shad_Age_0", scale = "Review_Stratum",print_name="Age-0 Delta Smelt"){
region_lookup <- Binary_Data %>%
select(Review_Region,Review_Stratum)%>%
distinct()
which_surveys <- Binary_Data %>%
ungroup %>%
select(SurveySeason,taxa)
names(which_surveys) <- c("SurveySeason","taxa")
print(which_surveys)
which_surveys%>%
group_by(SurveySeason)
summarise(n=n(),detection=sum(taxa))%>%
filter(n>99&detections!=0)%>%
ungroup()%>%
select(SurveySeason)%>%with(.,as.vector(SurveySeason))
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[1]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[1])%>%
left_join(region_lookup,by="Review_Stratum")
for(i in 2:length(which_surveys)){
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[i]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat_a <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[i])%>%
left_join(region_lookup,by="Review_Stratum")
plot_dat <- plot_dat %>% bind_rows(plot_dat_a)
}
plot_dat <- plot_dat %>% mutate(Review_Stratum = factor(Review_Stratum,levels=c("San Pablo Bay and Carquinez Strait",
"Napa River",
"Suisun and Honker Bays",
"Suisun Marsh",
"Confluence",
"South",
"North and South Forks Mokelumne River",
"Cache Slough",
"Sacramento Mainstem",
"Sacramento Ship Channel")))%>%
rename("Review Stratum" = "Review_Stratum")%>%
rename("Review Region" = "Review_Region")%>%
mutate(Upper = if_else(Upper==1 & Estimate==0,0,Upper))
print(plot_dat %>% ggplot(aes(y=`Review Stratum`,x=Estimate,col=`Review Region`))+theme_bw()+
scale_color_manual(values=wes_palette(n=5, name="Zissou1"))+
geom_vline(xintercept = 0)+xlab("Probability of Catch")+
geom_linerange(aes(xmin=Lower,xmax=Upper),size=1.5)+ggtitle(paste(print_name,"catch probabilities by region and strata"))+
geom_point(size=2.5)+
facet_grid(cols=vars(Survey)))
return(plot_dat)
}
Plot_Comparisons(taxa="CPUV_Delta_Smelt_Age_0",print_name = "Age-0 delta smelt")
Plot_Comparisons <- function(taxa = "CPUV_American_Shad_Age_0", scale = "Review_Stratum",print_name="Age-0 Delta Smelt"){
region_lookup <- Binary_Data %>%
select(Review_Region,Review_Stratum)%>%
distinct()
which_surveys <- Binary_Data %>%
ungroup %>%
select(SurveySeason,taxa)
names(which_surveys) <- c("SurveySeason","taxa")
which_surveys%>%
group_by(SurveySeason)%>%
summarise(n=n(),detection=sum(taxa))%>%
filter(n>99&detections!=0)%>%
ungroup()%>%
select(SurveySeason)%>%with(.,as.vector(SurveySeason))
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[1]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[1])%>%
left_join(region_lookup,by="Review_Stratum")
for(i in 2:length(which_surveys)){
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[i]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat_a <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[i])%>%
left_join(region_lookup,by="Review_Stratum")
plot_dat <- plot_dat %>% bind_rows(plot_dat_a)
}
plot_dat <- plot_dat %>% mutate(Review_Stratum = factor(Review_Stratum,levels=c("San Pablo Bay and Carquinez Strait",
"Napa River",
"Suisun and Honker Bays",
"Suisun Marsh",
"Confluence",
"South",
"North and South Forks Mokelumne River",
"Cache Slough",
"Sacramento Mainstem",
"Sacramento Ship Channel")))%>%
rename("Review Stratum" = "Review_Stratum")%>%
rename("Review Region" = "Review_Region")%>%
mutate(Upper = if_else(Upper==1 & Estimate==0,0,Upper))
print(plot_dat %>% ggplot(aes(y=`Review Stratum`,x=Estimate,col=`Review Region`))+theme_bw()+
scale_color_manual(values=wes_palette(n=5, name="Zissou1"))+
geom_vline(xintercept = 0)+xlab("Probability of Catch")+
geom_linerange(aes(xmin=Lower,xmax=Upper),size=1.5)+ggtitle(paste(print_name,"catch probabilities by region and strata"))+
geom_point(size=2.5)+
facet_grid(cols=vars(Survey)))
return(plot_dat)
}
Plot_Comparisons(taxa="CPUV_Delta_Smelt_Age_0",print_name = "Age-0 delta smelt")
Plot_Comparisons <- function(taxa = "CPUV_American_Shad_Age_0", scale = "Review_Stratum",print_name="Age-0 Delta Smelt"){
region_lookup <- Binary_Data %>%
select(Review_Region,Review_Stratum)%>%
distinct()
which_surveys <- Binary_Data %>%
ungroup %>%
select(SurveySeason,taxa)
names(which_surveys) <- c("SurveySeason","taxa")
which_surveys%>%
group_by(SurveySeason)%>%
summarise(n=n(),detection=sum(taxa))%>%
filter(n>99&detection!=0)%>%
ungroup()%>%
select(SurveySeason)%>%with(.,as.vector(SurveySeason))
print(which_surveys)
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[1]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[1])%>%
left_join(region_lookup,by="Review_Stratum")
for(i in 2:length(which_surveys)){
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[i]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat_a <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[i])%>%
left_join(region_lookup,by="Review_Stratum")
plot_dat <- plot_dat %>% bind_rows(plot_dat_a)
}
plot_dat <- plot_dat %>% mutate(Review_Stratum = factor(Review_Stratum,levels=c("San Pablo Bay and Carquinez Strait",
"Napa River",
"Suisun and Honker Bays",
"Suisun Marsh",
"Confluence",
"South",
"North and South Forks Mokelumne River",
"Cache Slough",
"Sacramento Mainstem",
"Sacramento Ship Channel")))%>%
rename("Review Stratum" = "Review_Stratum")%>%
rename("Review Region" = "Review_Region")%>%
mutate(Upper = if_else(Upper==1 & Estimate==0,0,Upper))
print(plot_dat %>% ggplot(aes(y=`Review Stratum`,x=Estimate,col=`Review Region`))+theme_bw()+
scale_color_manual(values=wes_palette(n=5, name="Zissou1"))+
geom_vline(xintercept = 0)+xlab("Probability of Catch")+
geom_linerange(aes(xmin=Lower,xmax=Upper),size=1.5)+ggtitle(paste(print_name,"catch probabilities by region and strata"))+
geom_point(size=2.5)+
facet_grid(cols=vars(Survey)))
return(plot_dat)
}
Plot_Comparisons(taxa="CPUV_Delta_Smelt_Age_0",print_name = "Age-0 delta smelt")
Plot_Comparisons <- function(taxa = "CPUV_American_Shad_Age_0", scale = "Review_Stratum",print_name="Age-0 Delta Smelt"){
region_lookup <- Binary_Data %>%
select(Review_Region,Review_Stratum)%>%
distinct()
which_surveys <- Binary_Data %>%
ungroup %>%
select(SurveySeason,taxa)
names(which_surveys) <- c("SurveySeason","taxa")
which_surveys <-  which_surveys%>%
group_by(SurveySeason)%>%
summarise(n=n(),detection=sum(taxa))%>%
filter(n>99&detection!=0)%>%
ungroup()%>%
select(SurveySeason)%>%with(.,as.vector(SurveySeason))
print(which_surveys)
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[1]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[1])%>%
left_join(region_lookup,by="Review_Stratum")
for(i in 2:length(which_surveys)){
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[i]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat_a <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[i])%>%
left_join(region_lookup,by="Review_Stratum")
plot_dat <- plot_dat %>% bind_rows(plot_dat_a)
}
plot_dat <- plot_dat %>% mutate(Review_Stratum = factor(Review_Stratum,levels=c("San Pablo Bay and Carquinez Strait",
"Napa River",
"Suisun and Honker Bays",
"Suisun Marsh",
"Confluence",
"South",
"North and South Forks Mokelumne River",
"Cache Slough",
"Sacramento Mainstem",
"Sacramento Ship Channel")))%>%
rename("Review Stratum" = "Review_Stratum")%>%
rename("Review Region" = "Review_Region")%>%
mutate(Upper = if_else(Upper==1 & Estimate==0,0,Upper))
print(plot_dat %>% ggplot(aes(y=`Review Stratum`,x=Estimate,col=`Review Region`))+theme_bw()+
scale_color_manual(values=wes_palette(n=5, name="Zissou1"))+
geom_vline(xintercept = 0)+xlab("Probability of Catch")+
geom_linerange(aes(xmin=Lower,xmax=Upper),size=1.5)+ggtitle(paste(print_name,"catch probabilities by region and strata"))+
geom_point(size=2.5)+
facet_grid(cols=vars(Survey)))
return(plot_dat)
}
Plot_Comparisons(taxa="CPUV_Delta_Smelt_Age_0",print_name = "Age-0 delta smelt")
Plot_Comparisons(taxa="CPUV_Striped_Bass_Age_0",print_name = "Age-0 striped bass")
Plot_Comparisons(taxa="CPUV_American_Shad_Age_0",print_name = "Age-0 American shad")
Plot_Comparisons(taxa="CPUV_Crangon",print_name = "Crangon")
Plot_Comparisons(taxa="CPUV_Gelatinous",print_name = "Gelatinous")
Plot_Comparisons(taxa="CPUV_Striped_Bass_Age_1",print_name = "Age-1 striped bass")
Plot_Comparisons(taxa="CPUV_Threadfin_Shad_Age_0",print_name = "Age-0 Threadfin shad")
Plot_Comparisons(taxa="CPUV_Threadfin_Shad_Age_1",print_name = "Age-1 Threadfin shad")
Plot_Comparisons(taxa="CPUV_Tridentiger_Spp._Age_0",print_name = "Age-0 Tridentiger Spp.")
Plot_Comparisons <- function(taxa = "CPUV_American_Shad_Age_0", scale = "Review_Stratum",print_name="Age-0 Delta Smelt"){
region_lookup <- Binary_Data %>%
select(Review_Region,Review_Stratum)%>%
distinct()
which_surveys <- Binary_Data %>%
ungroup %>%
select(SurveySeason,taxa)
names(which_surveys) <- c("SurveySeason","taxa")
which_surveys <-  which_surveys%>%
group_by(SurveySeason)%>%
summarise(n=n(),detection=sum(taxa))%>%
filter(n>99&detection!=0)%>%
ungroup()%>%
select(SurveySeason)%>%with(.,as.vector(SurveySeason))
print(which_surveys)
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[1]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[1])%>%
left_join(region_lookup,by="Review_Stratum")
for(i in 2:length(which_surveys)){
trim_dat <- Binary_Data %>% filter(SurveySeason==which_surveys[i]) %>%
select(scale,taxa,Year,StationCode)%>%mutate(Year = as.factor(Year))
names(trim_dat) <- c("Review_Stratum","species","Year","StationCode")
fit_glm <-  glmer(data=trim_dat, species~0+Review_Stratum+(1|Year)+(1|StationCode),family="binomial",nAGQ=0)
plot_dat_a <-
summary(fit_glm)$coefficients%>%data.frame()%>%
rownames_to_column("Review_Stratum")%>%
rename("SE" = "Std..Error", "p_value" = "Pr...z..")%>%
select(-z.value)%>%
mutate(Upper=Estimate+(2*SE),
Lower=Estimate-(2*SE))%>%
mutate_at(vars(c(Estimate,Upper,Lower)),ilink)%>%
mutate_if(is.numeric,round,4)%>%as_tibble()%>%
mutate(Review_Stratum = str_remove(Review_Stratum,"Review_Stratum"))%>%
add_column(Survey = which_surveys[i])%>%
left_join(region_lookup,by="Review_Stratum")
plot_dat <- plot_dat %>% bind_rows(plot_dat_a)
}
plot_dat <- plot_dat %>% mutate(Review_Stratum = factor(Review_Stratum,levels=c("San Pablo Bay and Carquinez Strait",
"Napa River",
"Suisun and Honker Bays",
"Suisun Marsh",
"Confluence",
"South",
"North and South Forks Mokelumne River",
"Cache Slough",
"Sacramento Mainstem",
"Sacramento Ship Channel")))%>%
rename("Review Stratum" = "Review_Stratum")%>%
rename("Review Region" = "Review_Region")%>%
mutate(Upper = if_else(Upper==1 & Estimate==0,0,Upper))%>%
mutate(Lower = if_else(Upper==1 & Estimate==1,1,Lower))
print(plot_dat %>% ggplot(aes(y=`Review Stratum`,x=Estimate,col=`Review Region`))+theme_bw()+
scale_color_manual(values=wes_palette(n=5, name="Zissou1"))+
geom_vline(xintercept = 0)+xlab("Probability of Catch")+
geom_linerange(aes(xmin=Lower,xmax=Upper),size=1.5)+ggtitle(paste(print_name,"catch probabilities by region and strata"))+
geom_point(size=2.5)+
facet_grid(cols=vars(Survey)))
return(plot_dat)
}
Plot_Comparisons(taxa="CPUV_Tridentiger_Spp._Age_0",print_name = "Age-0 Tridentiger Spp.")
names(Binary_Data)
Plot_Comparisons(taxa="CPUV_Delta_Smelt_Age_0",print_name = "Age-0 delta smelt")
Plot_Comparisons(taxa="CPUV_Longfin_Smelt_Age_0",print_name = "Age-0 longfin smelt")
