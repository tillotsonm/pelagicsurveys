pivot_wider(values_from = c(CPUV,Mean_Length),names_from = CommonName)%>%
mutate_at(vars(contains("CPUV")), ~replace_na(., 0))%>%
select(-c(CPUV_No_Catch,Mean_Length_No_Catch))%>%
#Drop presumed duplicated tows that have the same date, station and tow number, but differences in
#Environmental measurements.
distinct(across(c("SampleDate","StationCode","SurveySeason","TowNumber")),.keep_all = T)
Review_Data_Long <- Working_Data_Review%>%filter(CommonName != "No_Catch")%>%
mutate(CommonName = as.factor(CommonName))
#Create station-level summary
Mean <- function(x){return(mean(x,na.rm=T))}
CV <- function(x){return(sd(x,na.rm=T)/mean(x,na.rm=T))}
Review_Data_Stations <- Review_Data_Tows %>%
select(SurveySeason:CPUV_Prickly_Sculpin_Age_0)%>%
select(-c(Tide,Weather,Waves,TowNumber))%>%
group_by(StationCode)%>%
mutate(N_Dates = length(unique(SampleDate)),
N_Years = length(unique(Year)),
Mean_TowsPerYear = round(N_Dates/N_Years,0))%>%
mutate(Surveys = paste(unique(SurveySeason),collapse=","),.after = StationCode)%>%
group_by(StationCode,SurveySeason)%>%
mutate_at(c("Turbidity","Salinity","Temperature","Depth","TowDepth","Volume"),list(Mean=Mean,CV=CV))%>%
mutate_at(vars(contains("CPUV")),mean)%>%
select(-c(SurveySeason:SampleDate,Temperature:Salinity))%>%
ungroup()%>%
distinct(across(c(StationCode,SurveySeason)),.keep_all = T)%>%
filter(N_Years>9)#%>%
# mutate(FMWT = if_else(grepl("FMWT",Surveys),TRUE,FALSE),
#        STN = if_else(grepl("STN",Surveys),TRUE,FALSE),
#        SLS = if_else(grepl("SLS",Surveys),TRUE,FALSE),
#        SKT = if_else(grepl("SKT",Surveys),TRUE,FALSE),
#        TMM = if_else(grepl("20mm",Surveys),TRUE,FALSE),
#        .after = Surveys
#        )
save(Review_Data_Long,Review_Data_Tows,Review_Data_Stations,Review_Enviro_Hydro,file="FINAL_REVIEW_DATA/CDFW_Pelagic_Review_Data.rda")
load("FINAL_REVIEW_DATA/CDFW_Pelagic_Review_Data.rda")
dat_binary <- Review_Data_Tows%>%
filter(is.na(SubRegion)==F) %>%
mutate(TowDepth = if_else(is.na(TowDepth)==F&TowDepth<0,0,TowDepth))%>%
group_by(StationCode,Year,Month,SurveySeason,Region,SubRegion,Station_Latitude,Station_Longitude)%>%
summarise_at(vars(c(contains("CPUV"),Salinity,Secchi,Temperature,Depth,TowDepth)),mean,na.rm=T)%>%
ungroup()%>%
mutate(Salinity = round(Salinity,1))%>%
mutate_at(vars(contains("CPUV")),~if_else(.==0,0,1))%>%
add_column(PC1 = Station_PCA$x[,1])%>%
add_column(PC2 = Station_PCA$x[,2])%>%
data.frame()
dat_binary$Salinity[is.nan(dat_binary$Salinity)==T] <- NA
tapply(Review_Data_Tows$Secchi,Review_Data_Tows$SurveySeason,mean,na.rm=T)
dat_binary %>% ggplot(aes(x=Secchi,fill=as.factor(CPUV_Delta_Smelt_Age_0)))+geom_density()
Station_PCA <- prcomp(Full_PCA_Input)
plot(Station_PCA$x[,1:2],col=Full_PCA_Variables$Region)
Full_PCA_Variables<- Review_Data_Tows %>%
filter(SurveySeason!="SLS" & is.na(SubRegion)==F) %>%
group_by(StationCode,Year,Month,SurveySeason,Region,SubRegion,Station_Latitude,Station_Longitude)%>%
summarise_at(vars(c(contains("CPUV"),Salinity,Secchi,Temperature,Depth,)),mean,na.rm=T)%>%
ungroup()
Full_PCA_Input <- Full_PCA_Variables%>%
select((contains("CPUV")))%>%
.^(1/3) %>%
vegan::decostand("standardize")%>%
select_if(~ !any(is.na(.)))
Station_PCA <- prcomp(Full_PCA_Input)
plot(Station_PCA$x[,1:2],col=Full_PCA_Variables$Region)
biplot(Station_PCA)
dat_binary <- Review_Data_Tows%>%
filter(is.na(SubRegion)==F) %>%
mutate(TowDepth = if_else(is.na(TowDepth)==F&TowDepth<0,0,TowDepth))%>%
group_by(StationCode,Year,Month,SurveySeason,Region,SubRegion,Station_Latitude,Station_Longitude)%>%
summarise_at(vars(c(contains("CPUV"),Salinity,Secchi,Temperature,Depth,TowDepth)),mean,na.rm=T)%>%
ungroup()%>%
mutate(Salinity = round(Salinity,1))%>%
mutate_at(vars(contains("CPUV")),~if_else(.==0,0,1))%>%
add_column(PC1 = Station_PCA$x[,1])%>%
add_column(PC2 = Station_PCA$x[,2])%>%
data.frame()
Full_PCA_Variables<- Review_Data_Tows %>%
filter(is.na(SubRegion)==F) %>%
group_by(StationCode,Year,Month,SurveySeason,Region,SubRegion,Station_Latitude,Station_Longitude)%>%
summarise_at(vars(c(contains("CPUV"),Salinity,Secchi,Temperature,Depth,)),mean,na.rm=T)%>%
ungroup()
Full_PCA_Input <- Full_PCA_Variables%>%
select((contains("CPUV")))%>%
.^(1/3) %>%
vegan::decostand("standardize")%>%
select_if(~ !any(is.na(.)))
Station_PCA <- prcomp(Full_PCA_Input)
plot(Station_PCA$x[,1:2],col=Full_PCA_Variables$Region)
plot(Station_PCA$x[,1:2],col=Full_PCA_Variables$SurveySeason)
dat_binary <- Review_Data_Tows%>%
filter(is.na(SubRegion)==F) %>%
mutate(TowDepth = if_else(is.na(TowDepth)==F&TowDepth<0,0,TowDepth))%>%
group_by(StationCode,Year,Month,SurveySeason,Region,SubRegion,Station_Latitude,Station_Longitude)%>%
summarise_at(vars(c(contains("CPUV"),Salinity,Secchi,Temperature,Depth,TowDepth)),mean,na.rm=T)%>%
ungroup()%>%
mutate(Salinity = round(Salinity,1))%>%
mutate_at(vars(contains("CPUV")),~if_else(.==0,0,1))%>%
add_column(PC1 = Station_PCA$x[,1])%>%
add_column(PC2 = Station_PCA$x[,2])%>%
data.frame()
dat_binary$Salinity[is.nan(dat_binary$Salinity)==T] <- NA
tapply(Review_Data_Tows$Secchi,Review_Data_Tows$SurveySeason,mean,na.rm=T)
dat_binary %>% ggplot(aes(x=Secchi,fill=as.factor(CPUV_Delta_Smelt_Age_0)))+geom_density()
brt_full_Anchovy_0 <- gbm.step(data=data.frame(dat_binary),
gbm.x = c(3,4,8,34:36,37),
gbm.y= 10,
family="bernoulli",
step.size = 50,
learning.rate=.75
)
summary(brt_full_Anchovy_0)
gbm.plot(brt_full_Anchovy_0)
#Delta Smelt age-0
brt_full_DS_0 <- gbm.step(data=data.frame(dat_binary),
gbm.x = c(3,4,8,34:36,37),
gbm.y= 22,
family="bernoulli",
step.size = 100,
learning.rate = .5
)
summary(brt_DS_0)
gbm.plot(brt_DS_0)
#Striped bass age-0
brt_full_SB_0 <- gbm.step(data=data.frame(dat_binary),
gbm.x = c(3,4,8,34:36,38),
gbm.y= 19,
family="bernoulli",
step.size = 50,
learning.rate = .1
)
summary(brt_SB_0)
gbm.plot(brt_SB_0)
#Longfin smelt age-1
brt_full_LF_0 <- gbm.step(data=data.frame(dat_binary),
gbm.x = c(3,4,8,34:36,38),
gbm.y= 12,
family="bernoulli",
step.size = 100,
learning.rate=.5
)
summary(brt_LF_0)
gbm.plot(brt_LF_0)
table(is.na(Review_Data_Tows$TowDepth),Review_Data_Tows$SurveySeason)
names(Review_Data_Tows)
names(dat_binary)
brt_full_Anchovy_0 <- gbm.step(data=data.frame(dat_binary),
gbm.x = c(3,4,8,36:39),
gbm.y= 10,
family="bernoulli",
step.size = 50,
learning.rate=.75
)
summary(brt_full_Anchovy_0)
gbm.plot(brt_full_Anchovy_0)
#Delta Smelt age-0
brt_full_DS_0 <- gbm.step(data=data.frame(dat_binary),
gbm.x = c(3,4,8,36:39),
gbm.y= 22,
family="bernoulli",
step.size = 100,
learning.rate = .5
)
summary(brt_DS_0)
gbm.plot(brt_DS_0)
#Striped bass age-0
brt_full_SB_0 <- gbm.step(data=data.frame(dat_binary),
gbm.x = c(3,4,8,36:39),
gbm.y= 19,
family="bernoulli",
step.size = 50,
learning.rate = .1
)
summary(brt_SB_0)
gbm.plot(brt_SB_0)
#Longfin smelt age-1
brt_full_LF_0 <- gbm.step(data=data.frame(dat_binary),
gbm.x = c(3,4,8,36:39),
gbm.y= 12,
family="bernoulli",
step.size = 100,
learning.rate=.5
)
summary(brt_full_LF_0)
gbm.plot(brt_full_LF_0)
gbm.plot(brt_SB_0)
summary(brt_full_SB_0)
gbm.plot(brt_full_SB_0)
gbm.plot(brt_full_DS_0)
summary(brt_full__DS_0)
summary(brt_full_DS_0)
names(dat_binary)
brt_PC1 <- gbm.step(data=data.frame(dat_binary),
gbm.x = c(3,4,8,36:39),
gbm.y= 41,
family="gaussian",
step.size = 100,
learning.rate=.5
)
summary(brt_PC1)
gbm.plot(brt_PC1)
plot(dat_binary$Salinity,dat_binary$PC1)
plot(dat_binary$Salinity,dat_binary$PC2)
Full_PCA_Variables<- Review_Data_Tows %>%
filter(SurveySeason != "SLS",is.na(SubRegion)==F) %>%
group_by(StationCode,Year,Month,SurveySeason,Region,SubRegion,Station_Latitude,Station_Longitude)%>%
summarise_at(vars(c(contains("CPUV"),Salinity,Secchi,Temperature,Depth,)),mean,na.rm=T)%>%
ungroup()
Full_PCA_Input <- Full_PCA_Variables%>%
select((contains("CPUV")))%>%
.^(1/3) %>%
vegan::decostand("standardize")%>%
select_if(~ !any(is.na(.)))
Station_PCA <- prcomp(Full_PCA_Input)
plot(Station_PCA$x[,1:2],col=Full_PCA_Variables$SurveySeason)
plot(Station_PCA$x[,1:2],col=Full_PCA_Variables$Region)
plot(Station_PCA$x[,1:2],col=Full_PCA_Variables$SurveySeason)
plot(Station_PCA$x[,1:2],col=Full_PCA_Variables$Region)
biplot(Station_PCA)
pca_brt_data <- Full_PCA_Variables %>%
add_column(PC1 = Station_PCA$x[,1])%>%
add_column(PC2 = Station_PCA$x[,2])
pca_brt_data <- Full_PCA_Variables %>%
add_column(PC1 = Station_PCA$x[,1])%>%
add_column(PC2 = Station_PCA$x[,2])%>%
data.frame()
names(pca_brt_data)
plot(pca_brt_data$Salinity,pca_brt_data$PC1)
plot(pca_brt_data$Salinity,pca_brt_data$PC2)
brt_PC1 <- gbm.step(data=pca_brt_data,
gbm.x = c(3,4,8,36:39),
gbm.y= 40,
family="gaussian",
step.size = 100,
learning.rate=.5
)
summary(brt_PC1)
gbm.plot(brt_PC1)
Env_Dat_Stations <- Review_Data_Tows %>%
select(SubRegion,StationCode,Station_Latitude,Station_Longitude,Temperature,Salinity,Secchi)%>%
filter(is.na(SubRegion)==F)%>%
group_by(SubRegion,StationCode)%>%
mutate(Station_Latitude=mean(Station_Latitude,na.rm=T),Station_Longitude=mean(Station_Longitude,na.rm=T))%>%
group_by(StationCode,SubRegion,Station_Longitude,Station_Latitude)%>%
drop_na()%>%
summarise_at(vars(c(Temperature,Salinity,Secchi)),list(mean=mean,CV=CV))%>%
ungroup()
Community_Matrix <- Env_Dat_Stations%>%
select(Temperature_mean:Secchi_CV)
CM_Stand <- Community_Matrix%>%
.^(1/3) %>%
vegan::decostand("standardize")
clust1 <- hclust(dist(CM_Stand))
plot(clust1)
Env_Dat_Stations %>%
add_column(Cluster =as.factor(cutree(clust1,k=8)))%>%
ggplot(aes(x=Station_Longitude,y=Station_Latitude,col=Cluster,label=SubRegion))+geom_text()
Env_Dat_Stations %>%
add_column(Cluster =as.factor(cutree(clust1,k=8)))%>%
ggplot(aes(x=Station_Longitude,y=Station_Latitude,col=Cluster,label=SubRegion))+geom_text()+
scale_color_viridis_d()
Env_Dat_Stations <- Review_Data_Tows %>%
select(SubRegion,StationCode,Station_Latitude,Station_Longitude,Temperature,Salinity,Secchi)%>%
filter(is.na(SubRegion)==F)%>%
group_by(SubRegion,StationCode)%>%
column_to_rownames("StationCode")%>%
mutate(Station_Latitude=mean(Station_Latitude,na.rm=T),Station_Longitude=mean(Station_Longitude,na.rm=T))%>%
group_by(StationCode,SubRegion,Station_Longitude,Station_Latitude)%>%
drop_na()%>%
summarise_at(vars(c(Temperature,Salinity,Secchi)),list(mean=mean,CV=CV))%>%
ungroup()
Env_Dat_Stations <- Review_Data_Tows %>%
select(SubRegion,StationCode,Station_Latitude,Station_Longitude,Temperature,Salinity,Secchi)%>%
filter(is.na(SubRegion)==F)%>%
group_by(SubRegion,StationCode)%>%
mutate(Station_Latitude=mean(Station_Latitude,na.rm=T),Station_Longitude=mean(Station_Longitude,na.rm=T))%>%
group_by(StationCode,SubRegion,Station_Longitude,Station_Latitude)%>%
drop_na()%>%
summarise_at(vars(c(Temperature,Salinity,Secchi)),list(mean=mean,CV=CV))%>%
ungroup()%>%
column_to_rownames("StationCode")
Community_Matrix <- Env_Dat_Stations%>%
select(Temperature_mean:Secchi_CV)
CM_Stand <- Community_Matrix%>%
.^(1/3) %>%
vegan::decostand("standardize")
clust1 <- hclust(dist(CM_Stand))
plot(clust1)
View(Community_Matrix)
View(Review_Data_Stations)
Review_Data_Tows%>%filter(StationCode=="794")
Review_Data_Tows%>%filter(StationCode=="794")%>%view()
Env_Dat_Stations <- Review_Data_Tows %>%
filter(StationCode != "794")%>%
select(SubRegion,StationCode,Station_Latitude,Station_Longitude,Temperature,Salinity,Secchi)%>%
filter(is.na(SubRegion)==F)%>%
group_by(SubRegion,StationCode)%>%
mutate(Station_Latitude=mean(Station_Latitude,na.rm=T),Station_Longitude=mean(Station_Longitude,na.rm=T))%>%
group_by(StationCode,SubRegion,Station_Longitude,Station_Latitude)%>%
drop_na()%>%
summarise_at(vars(c(Temperature,Salinity,Secchi)),list(mean=mean,CV=CV))%>%
ungroup()%>%
column_to_rownames("StationCode")
Community_Matrix <- Env_Dat_Stations%>%
select(Temperature_mean:Secchi_CV)
Env_Dat_Stations <- Review_Data_Tows %>%
filter(StationCode != "794")%>%
select(SubRegion,StationCode,Station_Latitude,Station_Longitude,Temperature,Salinity,Secchi)%>%
filter(is.na(SubRegion)==F)%>%
group_by(SubRegion,StationCode)%>%
mutate(N_Tows = n())%>%
mutate(Station_Latitude=mean(Station_Latitude,na.rm=T),Station_Longitude=mean(Station_Longitude,na.rm=T))%>%
group_by(StationCode,SubRegion,Station_Longitude,Station_Latitude)%>%
drop_na()%>%
summarise_at(vars(c(Temperature,Salinity,Secchi)),list(mean=mean,CV=CV))%>%
ungroup()%>%
column_to_rownames("StationCode")
Env_Dat_Stations <- Review_Data_Tows %>%
filter(StationCode != "794")%>%
select(SubRegion,StationCode,Station_Latitude,Station_Longitude,Temperature,Salinity,Secchi)%>%
filter(is.na(SubRegion)==F)%>%
group_by(SubRegion,StationCode)%>%
mutate(N_Tows = n())%>%
mutate(Station_Latitude=mean(Station_Latitude,na.rm=T),Station_Longitude=mean(Station_Longitude,na.rm=T))%>%
group_by(StationCode,SubRegion,Station_Longitude,Station_Latitude,N_Tows)%>%
drop_na()%>%
summarise_at(vars(c(Temperature,Salinity,Secchi)),list(mean=mean,CV=CV))%>%
ungroup()%>%
column_to_rownames("StationCode")
View(Env_Dat_Stations)
Env_Dat_Stations <- Review_Data_Tows %>%
filter(StationCode != "794")%>%
select(SubRegion,StationCode,Station_Latitude,Station_Longitude,Temperature,Salinity,Secchi)%>%
filter(is.na(SubRegion)==F)%>%
group_by(SubRegion,StationCode)%>%
mutate(N_Tows = n())%>%
mutate(Station_Latitude=mean(Station_Latitude,na.rm=T),Station_Longitude=mean(Station_Longitude,na.rm=T))%>%
group_by(StationCode,SubRegion,Station_Longitude,Station_Latitude,N_Tows)%>%
drop_na()%>%
summarise_at(vars(c(Temperature,Salinity,Secchi)),list(mean=mean,CV=CV))%>%
ungroup()
View(Env_Dat_Stations)
Env_Dat_Stations <- Review_Data_Tows %>%
#filter(StationCode != "794")%>%
select(SubRegion,StationCode,Station_Latitude,Station_Longitude,Temperature,Salinity,Secchi)%>%
filter(is.na(SubRegion)==F)%>%
group_by(SubRegion,StationCode)%>%
mutate(N_Tows = n())%>%
mutate(Station_Latitude=mean(Station_Latitude,na.rm=T),Station_Longitude=mean(Station_Longitude,na.rm=T))%>%
group_by(StationCode,SubRegion,Station_Longitude,Station_Latitude,N_Tows)%>%
drop_na()%>%
summarise_at(vars(c(Temperature,Salinity,Secchi)),list(mean=mean,CV=CV))%>%
ungroup()%>%
column_to_rownames("StationCode")
View(Env_Dat_Stations)
View(Env_Dat_Stations)
Env_Dat_Stations <- Review_Data_Tows %>%
filter(StationCode != "794")%>%
select(SubRegion,StationCode,Station_Latitude,Station_Longitude,Temperature,Salinity,Secchi)%>%
filter(is.na(SubRegion)==F)%>%
group_by(SubRegion,StationCode)%>%
mutate(N_Tows = n())%>%
mutate(Station_Latitude=mean(Station_Latitude,na.rm=T),Station_Longitude=mean(Station_Longitude,na.rm=T))%>%
group_by(StationCode,SubRegion,Station_Longitude,Station_Latitude,N_Tows)%>%
drop_na()%>%
summarise_at(vars(c(Temperature,Salinity,Secchi)),list(mean=mean,CV=CV))%>%
ungroup()%>%
column_to_rownames("StationCode")
Community_Matrix <- Env_Dat_Stations%>%
select(Temperature_mean:Secchi_CV)
CM_Stand <- Community_Matrix%>%
.^(1/3) %>%
vegan::decostand("standardize")
clust1 <- hclust(dist(CM_Stand))
plot(clust1)
Env_Dat_Stations %>%
add_column(Cluster =as.factor(cutree(clust1,k=8)))%>%
ggplot(aes(x=Station_Longitude,y=Station_Latitude,col=Cluster,label=SubRegion))+geom_text()+
scale_color_viridis_d()
Env_Dat_Stations %>%
add_column(Cluster =as.factor(cutree(clust1,k=5)))%>%
ggplot(aes(x=Station_Longitude,y=Station_Latitude,col=Cluster,label=SubRegion))+geom_text()+
scale_color_viridis_d()
Env_Dat_Stations %>%
add_column(Cluster =as.factor(cutree(clust1,k=5)))%>%
ggplot(aes(x=Station_Longitude,y=Station_Latitude,col=Cluster,label=SubRegion))+geom_text()
Env_Dat_Stations %>%
add_column(Cluster =as.factor(cutree(clust1,k=5)))%>%
ggplot(aes(x=Station_Longitude,y=Station_Latitude,col=Cluster,label=rownames()))+geom_text()
Env_Dat_Stations %>%
rownames_to_column("StationCode")%>%
add_column(Cluster =as.factor(cutree(clust1,k=5)))%>%
ggplot(aes(x=Station_Longitude,y=Station_Latitude,col=Cluster,label=StationCode))+geom_text()
Env_Dat_Stations %>%
rownames_to_column("StationCode")%>%
add_column(Cluster =as.factor(cutree(clust1,k=4)))%>%
ggplot(aes(x=Station_Longitude,y=Station_Latitude,col=Cluster,label=StationCode))+geom_text()
Env_Dat_Stations %>%
rownames_to_column("StationCode")%>%
add_column(Cluster =as.factor(cutree(clust1,k=4)))%>%
ggplot(aes(x=as.factor(Cluster),y=Salinity_mean))+geom_boxplot()
Env_Dat_Stations %>%
rownames_to_column("StationCode")%>%
add_column(Cluster =as.factor(cutree(clust1,k=4)))%>%
ggplot(aes(x=as.factor(Cluster),y=Salinity_CV))+geom_boxplot()
Env_Dat_Stations %>%
rownames_to_column("StationCode")%>%
add_column(Cluster =as.factor(cutree(clust1,k=4)))%>%
ggplot(aes(x=as.factor(Cluster),y=Secchi_CV))+geom_boxplot()
Env_Dat_Stations %>%
rownames_to_column("StationCode")%>%
add_column(Cluster =as.factor(cutree(clust1,k=4)))%>%
ggplot(aes(x=as.factor(Cluster),y=Secchi_Mean))+geom_boxplot()
Env_Dat_Stations %>%
rownames_to_column("StationCode")%>%
add_column(Cluster =as.factor(cutree(clust1,k=4)))%>%
ggplot(aes(x=as.factor(Cluster),y=Secchi_mean))+geom_boxplot()
Env_Dat_Stations %>%
rownames_to_column("StationCode")%>%
add_column(Cluster =as.factor(cutree(clust1,k=4)))%>%
ggplot(aes(x=as.factor(Cluster),y=Temperature_mean))+geom_boxplot()
table(is.na(Review_Data_Tows$Region)
table(is.na(Review_Data_Tows$Region))
table(is.na(Review_Data_Tows$Region))
table(is.na(Review_Data_Tows$Region),Review_Data_Tows$StationCode)
table(Review_Data_Tows$StationCode,is.na(Review_Data_Tows$Region))
Review_Data_Tows%>%ggplot(aes(x=TowDepth,fill=SurveySeason))+geom_density(alpha=.5)
#Load libraries:
require(ggforce)
require(tidyverse)
require(lubridate)
require(ggridges)
require(vegan)
require(ggbiplot)
theme_set(theme_bw())
#Set working directory
setwd("C:/Users/40545/Documents/GitHub/pelagicsurveys")
load("MASTER_Data/MASTER_Env_Hydro.rda")
ClusteringData <- Environment_Hydrology %>%
mutate(StationCode = if_else(Survey=="EDSM",
as.character(SubRegion),
as.character(StationCode)))%>%
mutate(StationCode = as.factor(StationCode))%>%
filter(WaterYear>1970 & is.na(Salinity)==F)%>%
select(-c(SAC:SacIndex,SJWinter:May8Riv,Field_coords))%>%
mutate(DOWY = yday(Date-92))%>%
mutate(WYWeek = ceiling(DOWY/7))%>%
group_by(Survey,StationCode)%>%
mutate(Station_Latitude = mean(Latitude,na.rm=T),
Station_Longitude = mean(Longitude,na.rm=T)
)%>%
select(-c(Longitude,Latitude,Survey_Station))%>%
group_by(Survey,StationCode,Month)%>%
mutate(Monthly_Surveys)
ClusteringData %>% group_by(Survey,StationCode,Month)%>%
dplyr::summarise(n())%>%view()
length(unique(ClusteringData$StationCode))
plot(ClusteringData$Conductivity,ClusteringData$Salinity)
dat <- ClusteringData%>%select(c(Salinity,Conductivity))%>%drop_na()
Env_Summary <-
Environment_Hydrology %>%
filter(WaterYear>1970)%>%
mutate(DOWW = yday(Date-92))%>%
mutate(WYWeek = ceiling(DOWW/7)) %>%
group_by(SacWYType,Month,SubRegion)%>%
dplyr::summarise(N_Samples = n(),
Temperature_Mean = mean(Temperature,na.rm=T),
Secchi_Mean = mean(Secchi,na.rm=T),
Conductivity_Mean = mean(Conductivity,na.rm=T),
Depth_Mean = mean(Depth,na.rm=T),
Temperature_SD = sd(Temperature,na.rm=T),
Secchi_SD = sd(Secchi,na.rm=T),
Conductivity_SD = sd(Conductivity,na.rm=T),
Depth_SD = sd(Depth,na.rm=T),
Date = min(Date))%>%
filter(N_Samples>4)%>%
drop_na()%>%
ungroup()
library("ggplot2")
theme_set(theme_bw())
library("sf")
library("tidyverse")
library("rnaturalearth")
library("rnaturalearthdata")
library("rnaturalearthhires")
library("stringr")
library("RColorBrewer")
library("spatialEco")
library("conflicted")
conflict_prefer("select","dplyr")
conflict_prefer("filter","dplyr")
setwd("C:/Users/40545/Documents/GitHub/pelagicsurveys")
load("MASTER_Data/MASTER_Long_Format.rda")
#===============Delta Base Layer================================
marsh <- st_read(
"CODE-spatial-analysis/hydro-delta-marsh/hydro_delta_marsh.shp")
EDSM_Strata <- st_read(
"CODE-spatial-analysis/DSm_Subregions_UTM10NAD83/DSm_Subregions_UTM10NAD83.shp")
Long_Master %>% distinct(across(c(SampleDate,SurveySeason,StationCode)),.keep_all = T)%>%
group_by(StationCode)%>%mutate(n.surveys = length(unique(SurveySeason)))%>%ungroup()%>%
filter(n.surveys>1)%>%
mutate(Location_Flag = if_else(StationCode %in% c("504","724","405","411", "704",
"812","815","906","915","323",
"340","345","418","501","519",
"703","705","706","711","716",
"723","801","901","914","804"),T,F))%>%
ggplot(aes(x=SurveySeason,y=DepthBottom,fill=Location_Flag))+geom_boxplot()+scale_fill_viridis_d()+
facet_wrap_paginate(~StationCode,ncol = 6, nrow = 5,page=3)
stations_compare_long <- Long_Master %>%
distinct(across(c(Station_Longitude,Station_Latitude,Survey_Station)),.keep_all = T)%>%
filter(is.na(Station_Latitude)==F)%>%select(c(Station_Longitude,Station_Latitude,Survey_Station,SubRegion))%>%
separate(Survey_Station,into=c("Survey","StationNum"),sep="_",remove = F)%>%
mutate_at(c("Survey_Station","Survey","StationNum"),as.factor)
Review_Data_Tows%>%ggplot(aes(x=TowDepth,fill=SurveySeason))+geom_density(alpha=.5)
